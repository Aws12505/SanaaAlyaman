import{j as e,r,F as U,H as We}from"./app-J-vuqqq4.js";import{r as ze,q as $e,s as Ve,b as Ge,c as qe,d as Ke,S as Qe,H as Je,f as Xe,g as Ze}from"./layout-D5rjpBYb.js";import{B as _}from"./index-HLZZ5dsL.js";import{C as Ue,a as Ye,b as et,c as tt,d as nt}from"./card-uwjD4-01.js";import{c as F,a as L,b as rt}from"./createLucideIcon-B0BDCCpf.js";import{C as at}from"./circle-alert-iLt37fFO.js";import{E as st}from"./eye-RIGtRBXB.js";import{I as ot}from"./input-error-Po7Qa73h.js";import{D as lt,b as it,g as ct,c as dt,d as ut}from"./dialog-BmpbQzgT.js";import{C as pt}from"./check-j9GkOTvs.js";import{C as ht}from"./copy-C_WsRzlT.js";import{B as be}from"./badge-CTZT9oI3.js";import{A as mt}from"./app-layout-Dqxjz56l.js";import"./app-Cb5yk_6x.js";import"./separator-Bzxjf8-x.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],xt=F("EyeOff",ft);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ye=F("LoaderCircle",vt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]],bt=F("LockKeyhole",gt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M5 12h14",key:"1ays0h"}]],jt=F("Minus",yt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ct=F("RefreshCw",wt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],kt=F("ScanLine",St);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m4.243 5.21 14.39 12.472",key:"1c9a7c"}]],Tt=F("ShieldBan",Nt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],je=F("ShieldCheck",Et),Mt=rt("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function Pt({className:n,variant:t,...a}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:L(Mt({variant:t}),n),...a})}function At({className:n,...t}){return e.jsx("div",{"data-slot":"alert-title",className:L("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",n),...t})}function Rt({className:n,...t}){return e.jsx("div",{"data-slot":"alert-description",className:L("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",n),...t})}function Ce({errors:n,title:t}){return e.jsxs(Pt,{variant:"destructive",children:[e.jsx(at,{}),e.jsx(At,{children:t||"Something went wrong."}),e.jsx(Rt,{children:e.jsx("ul",{className:"list-inside list-disc text-sm",children:Array.from(new Set(n)).map((a,s)=>e.jsx("li",{children:a},s))})})]})}function _t({recoveryCodesList:n,fetchRecoveryCodes:t,errors:a}){const[s,c]=r.useState(!1),i=r.useRef(null),p=n.length>0&&s,d=r.useCallback(async()=>{!s&&!n.length&&await t(),c(!s),s||setTimeout(()=>{i.current?.scrollIntoView({behavior:"smooth",block:"nearest"})})},[s,n.length,t]);r.useEffect(()=>{n.length||t()},[n.length,t]);const j=s?xt:st;return e.jsxs(Ue,{children:[e.jsxs(Ye,{children:[e.jsxs(et,{className:"flex gap-3",children:[e.jsx(bt,{className:"size-4","aria-hidden":"true"}),"2FA Recovery Codes"]}),e.jsx(tt,{children:"Recovery codes let you regain access if you lose your 2FA device. Store them in a secure password manager."})]}),e.jsxs(nt,{children:[e.jsxs("div",{className:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(_,{onClick:d,className:"w-fit","aria-expanded":s,"aria-controls":"recovery-codes-section",children:[e.jsx(j,{className:"size-4","aria-hidden":"true"}),s?"Hide":"View"," Recovery Codes"]}),p&&e.jsx(U,{...ze.form(),options:{preserveScroll:!0},onSuccess:t,children:({processing:m})=>e.jsxs(_,{variant:"secondary",type:"submit",disabled:m,"aria-describedby":"regenerate-warning",children:[e.jsx(Ct,{})," Regenerate Codes"]})})]}),e.jsx("div",{id:"recovery-codes-section",className:`relative overflow-hidden transition-all duration-300 ${s?"h-auto opacity-100":"h-0 opacity-0"}`,"aria-hidden":!s,children:e.jsx("div",{className:"mt-3 space-y-3",children:a?.length?e.jsx(Ce,{errors:a}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:i,className:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm",role:"list","aria-label":"Recovery codes",children:n.length?n.map((m,g)=>e.jsx("div",{role:"listitem",className:"select-text",children:m},g)):e.jsx("div",{className:"space-y-2","aria-label":"Loading recovery codes",children:Array.from({length:8},(m,g)=>e.jsx("div",{className:"h-4 animate-pulse rounded bg-muted-foreground/20","aria-hidden":"true"},g))})}),e.jsx("div",{className:"text-xs text-muted-foreground select-none",children:e.jsxs("p",{id:"regenerate-warning",children:["Each recovery code can be used once to access your account and will be removed after use. If you need more, click"," ",e.jsx("span",{className:"font-bold",children:"Regenerate Codes"})," ","above."]})})]})})})]})]})}var Ft=Object.defineProperty,Ot=Object.defineProperties,Dt=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Se=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,we=(n,t,a)=>t in n?Ft(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,It=(n,t)=>{for(var a in t||(t={}))Se.call(t,a)&&we(n,a,t[a]);if(Y)for(var a of Y(t))ke.call(t,a)&&we(n,a,t[a]);return n},Bt=(n,t)=>Ot(n,Dt(t)),Ht=(n,t)=>{var a={};for(var s in n)Se.call(n,s)&&t.indexOf(s)<0&&(a[s]=n[s]);if(n!=null&&Y)for(var s of Y(n))t.indexOf(s)<0&&ke.call(n,s)&&(a[s]=n[s]);return a};function Lt(n){let t=setTimeout(n,0),a=setTimeout(n,10),s=setTimeout(n,50);return[t,a,s]}function Wt(n){let t=r.useRef();return r.useEffect(()=>{t.current=n}),t.current}var zt=18,Ne=40,$t=`${Ne}px`,Vt=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function Gt({containerRef:n,inputRef:t,pushPasswordManagerStrategy:a,isFocused:s}){let[c,i]=r.useState(!1),[p,d]=r.useState(!1),[j,m]=r.useState(!1),g=r.useMemo(()=>a==="none"?!1:(a==="increase-width"||a==="experimental-no-flickering")&&c&&p,[c,p,a]),h=r.useCallback(()=>{let v=n.current,S=t.current;if(!v||!S||j||a==="none")return;let w=v,f=w.getBoundingClientRect().left+w.offsetWidth,W=w.getBoundingClientRect().top+w.offsetHeight/2,x=f-zt,V=W;document.querySelectorAll(Vt).length===0&&document.elementFromPoint(x,V)===v||(i(!0),m(!0))},[n,t,j,a]);return r.useEffect(()=>{let v=n.current;if(!v||a==="none")return;function S(){let f=window.innerWidth-v.getBoundingClientRect().right;d(f>=Ne)}S();let w=setInterval(S,1e3);return()=>{clearInterval(w)}},[n,a]),r.useEffect(()=>{let v=s||document.activeElement===t.current;if(a==="none"||!v)return;let S=setTimeout(h,0),w=setTimeout(h,2e3),f=setTimeout(h,5e3),W=setTimeout(()=>{m(!0)},6e3);return()=>{clearTimeout(S),clearTimeout(w),clearTimeout(f),clearTimeout(W)}},[t,s,a,h]),{hasPWMBadge:c,willPushPWMBadge:g,PWM_BADGE_SPACE_WIDTH:$t}}var Te=r.createContext({}),Ee=r.forwardRef((n,t)=>{var a=n,{value:s,onChange:c,maxLength:i,textAlign:p="left",pattern:d,placeholder:j,inputMode:m="numeric",onComplete:g,pushPasswordManagerStrategy:h="increase-width",pasteTransformer:v,containerClassName:S,noScriptCSSFallback:w=qt,render:f,children:W}=a,x=Ht(a,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),V,le,ie,ce,de;let[Re,_e]=r.useState(typeof x.defaultValue=="string"?x.defaultValue:""),b=s??Re,O=Wt(b),G=r.useCallback(o=>{c?.(o),_e(o)},[c]),M=r.useMemo(()=>d?typeof d=="string"?new RegExp(d):d:null,[d]),y=r.useRef(null),ee=r.useRef(null),te=r.useRef({value:b,onChange:G,isIOS:typeof window<"u"&&((le=(V=window?.CSS)==null?void 0:V.supports)==null?void 0:le.call(V,"-webkit-touch-callout","none"))}),X=r.useRef({prev:[(ie=y.current)==null?void 0:ie.selectionStart,(ce=y.current)==null?void 0:ce.selectionEnd,(de=y.current)==null?void 0:de.selectionDirection]});r.useImperativeHandle(t,()=>y.current,[]),r.useEffect(()=>{let o=y.current,l=ee.current;if(!o||!l)return;te.current.value!==o.value&&te.current.onChange(o.value),X.current.prev=[o.selectionStart,o.selectionEnd,o.selectionDirection];function C(){if(document.activeElement!==o){K(null),Q(null);return}let u=o.selectionStart,k=o.selectionEnd,Z=o.selectionDirection,E=o.maxLength,I=o.value,P=X.current.prev,A=-1,R=-1,B;if(I.length!==0&&u!==null&&k!==null){let Be=u===k,He=u===I.length&&I.length<E;if(Be&&!He){let H=u;if(H===0)A=0,R=1,B="forward";else if(H===E)A=H-1,R=H,B="backward";else if(E>1&&I.length>1){let ae=0;if(P[0]!==null&&P[1]!==null){B=H<P[1]?"backward":"forward";let Le=P[0]===P[1]&&P[0]<E;B==="backward"&&!Le&&(ae=-1)}A=ae+H,R=ae+H+1}}A!==-1&&R!==-1&&A!==R&&y.current.setSelectionRange(A,R,B)}let ve=A!==-1?A:u,ge=R!==-1?R:k,Ie=B??Z;K(ve),Q(ge),X.current.prev=[ve,ge,Ie]}if(document.addEventListener("selectionchange",C,{capture:!0}),C(),document.activeElement===o&&ne(!0),!document.getElementById("input-otp-style")){let u=document.createElement("style");if(u.id="input-otp-style",document.head.appendChild(u),u.sheet){let k="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";J(u.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),J(u.sheet,`[data-input-otp]:autofill { ${k} }`),J(u.sheet,`[data-input-otp]:-webkit-autofill { ${k} }`),J(u.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),J(u.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let N=()=>{l&&l.style.setProperty("--root-height",`${o.clientHeight}px`)};N();let T=new ResizeObserver(N);return T.observe(o),()=>{document.removeEventListener("selectionchange",C,{capture:!0}),T.disconnect()}},[]);let[ue,pe]=r.useState(!1),[q,ne]=r.useState(!1),[D,K]=r.useState(null),[z,Q]=r.useState(null);r.useEffect(()=>{Lt(()=>{var o,l,C,N;(o=y.current)==null||o.dispatchEvent(new Event("input"));let T=(l=y.current)==null?void 0:l.selectionStart,u=(C=y.current)==null?void 0:C.selectionEnd,k=(N=y.current)==null?void 0:N.selectionDirection;T!==null&&u!==null&&(K(T),Q(u),X.current.prev=[T,u,k])})},[b,q]),r.useEffect(()=>{O!==void 0&&b!==O&&O.length<i&&b.length===i&&g?.(b)},[i,g,O,b]);let $=Gt({containerRef:ee,inputRef:y,pushPasswordManagerStrategy:h,isFocused:q}),he=r.useCallback(o=>{let l=o.currentTarget.value.slice(0,i);if(l.length>0&&M&&!M.test(l)){o.preventDefault();return}typeof O=="string"&&l.length<O.length&&document.dispatchEvent(new Event("selectionchange")),G(l)},[i,G,O,M]),me=r.useCallback(()=>{var o;if(y.current){let l=Math.min(y.current.value.length,i-1),C=y.current.value.length;(o=y.current)==null||o.setSelectionRange(l,C),K(l),Q(C)}ne(!0)},[i]),fe=r.useCallback(o=>{var l,C;let N=y.current;if(!v&&(!te.current.isIOS||!o.clipboardData||!N))return;let T=o.clipboardData.getData("text/plain"),u=v?v(T):T;o.preventDefault();let k=(l=y.current)==null?void 0:l.selectionStart,Z=(C=y.current)==null?void 0:C.selectionEnd,E=(k!==Z?b.slice(0,k)+u+b.slice(Z):b.slice(0,k)+u+b.slice(k)).slice(0,i);if(E.length>0&&M&&!M.test(E))return;N.value=E,G(E);let I=Math.min(E.length,i-1),P=E.length;N.setSelectionRange(I,P),K(I),Q(P)},[i,G,M,b]),Fe=r.useMemo(()=>({position:"relative",cursor:x.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[x.disabled]),xe=r.useMemo(()=>({position:"absolute",inset:0,width:$.willPushPWMBadge?`calc(100% + ${$.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:$.willPushPWMBadge?`inset(0 ${$.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:p,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[$.PWM_BADGE_SPACE_WIDTH,$.willPushPWMBadge,p]),Oe=r.useMemo(()=>r.createElement("input",Bt(It({autoComplete:x.autoComplete||"one-time-code"},x),{"data-input-otp":!0,"data-input-otp-placeholder-shown":b.length===0||void 0,"data-input-otp-mss":D,"data-input-otp-mse":z,inputMode:m,pattern:M?.source,"aria-placeholder":j,style:xe,maxLength:i,value:b,ref:y,onPaste:o=>{var l;fe(o),(l=x.onPaste)==null||l.call(x,o)},onChange:he,onMouseOver:o=>{var l;pe(!0),(l=x.onMouseOver)==null||l.call(x,o)},onMouseLeave:o=>{var l;pe(!1),(l=x.onMouseLeave)==null||l.call(x,o)},onFocus:o=>{var l;me(),(l=x.onFocus)==null||l.call(x,o)},onBlur:o=>{var l;ne(!1),(l=x.onBlur)==null||l.call(x,o)}})),[he,me,fe,m,xe,i,z,D,x,M?.source,b]),re=r.useMemo(()=>({slots:Array.from({length:i}).map((o,l)=>{var C;let N=q&&D!==null&&z!==null&&(D===z&&l===D||l>=D&&l<z),T=b[l]!==void 0?b[l]:null,u=b[0]!==void 0?null:(C=j?.[l])!=null?C:null;return{char:T,placeholderChar:u,isActive:N,hasFakeCaret:N&&T===null}}),isFocused:q,isHovering:!x.disabled&&ue}),[q,ue,i,z,D,x.disabled,b]),De=r.useMemo(()=>f?f(re):r.createElement(Te.Provider,{value:re},W),[W,re,f]);return r.createElement(r.Fragment,null,w!==null&&r.createElement("noscript",null,r.createElement("style",null,w)),r.createElement("div",{ref:ee,"data-input-otp-container":!0,style:Fe,className:S},De,r.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Oe)))});Ee.displayName="Input";function J(n,t){try{n.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var qt=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`,Kt="^\\d+$";const Me=r.forwardRef(({className:n,containerClassName:t,...a},s)=>e.jsx(Ee,{ref:s,containerClassName:L("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:L("disabled:cursor-not-allowed",n),...a}));Me.displayName="InputOTP";const Pe=r.forwardRef(({className:n,...t},a)=>e.jsx("div",{ref:a,className:L("flex items-center",n),...t}));Pe.displayName="InputOTPGroup";const Ae=r.forwardRef(({index:n,className:t,...a},s)=>{const c=r.useContext(Te),{char:i,hasFakeCaret:p,isActive:d}=c.slots[n];return e.jsxs("div",{ref:s,className:L("relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",d&&"z-10 ring-1 ring-ring",t),...a,children:[i,p&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});Ae.displayName="InputOTPSlot";const Qt=r.forwardRef(({...n},t)=>e.jsx("div",{ref:t,role:"separator",...n,children:e.jsx(jt,{})}));Qt.displayName="InputOTPSeparator";function Jt(){const[n,t]=r.useState(null),a=r.useCallback(async s=>{if(!navigator?.clipboard)return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(s),t(s),!0}catch(c){return console.warn("Copy failed",c),t(null),!1}},[]);return[n,a]}const se=6,oe=async n=>{const t=await fetch(n,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Failed to fetch: ${t.status}`);return t.json()},Xt=()=>{const[n,t]=r.useState(null),[a,s]=r.useState(null),[c,i]=r.useState([]),[p,d]=r.useState([]),j=r.useMemo(()=>n!==null&&a!==null,[n,a]),m=r.useCallback(async()=>{try{const{svg:f}=await oe($e.url());t(f)}catch{d(f=>[...f,"Failed to fetch QR code"]),t(null)}},[]),g=r.useCallback(async()=>{try{const{secretKey:f}=await oe(Ve.url());s(f)}catch{d(f=>[...f,"Failed to fetch a setup key"]),s(null)}},[]),h=r.useCallback(()=>{d([])},[]),v=r.useCallback(()=>{s(null),t(null),h()},[h]),S=r.useCallback(async()=>{try{h();const f=await oe(Ge.url());i(f)}catch{d(f=>[...f,"Failed to fetch recovery codes"]),i([])}},[h]),w=r.useCallback(async()=>{try{h(),await Promise.all([m(),g()])}catch{t(null),s(null)}},[h,m,g]);return{qrCodeSvg:n,manualSetupKey:a,recoveryCodesList:c,hasSetupData:j,errors:p,clearErrors:h,clearSetupData:v,fetchQrCode:m,fetchSetupKey:g,fetchSetupData:w,fetchRecoveryCodes:S}};function Zt(){return e.jsx("div",{className:"mb-3 rounded-full border border-border bg-card p-0.5 shadow-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5",children:[e.jsx("div",{className:"absolute inset-0 grid grid-cols-5 opacity-50",children:Array.from({length:5},(n,t)=>e.jsx("div",{className:"border-r border-border last:border-r-0"},`col-${t+1}`))}),e.jsx("div",{className:"absolute inset-0 grid grid-rows-5 opacity-50",children:Array.from({length:5},(n,t)=>e.jsx("div",{className:"border-b border-border last:border-b-0"},`row-${t+1}`))}),e.jsx(kt,{className:"relative z-20 size-6 text-foreground"})]})})}function Ut({qrCodeSvg:n,manualSetupKey:t,buttonText:a,onNextStep:s,errors:c}){const[i,p]=Jt(),d=i===t?pt:ht;return e.jsx(e.Fragment,{children:c?.length?e.jsx(Ce,{errors:c}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex max-w-md overflow-hidden",children:e.jsx("div",{className:"mx-auto aspect-square w-64 rounded-lg border border-border",children:e.jsx("div",{className:"z-10 flex h-full w-full items-center justify-center p-5",children:n?e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}):e.jsx(ye,{className:"flex size-4 animate-spin"})})})}),e.jsx("div",{className:"flex w-full space-x-5",children:e.jsx(_,{className:"w-full",onClick:s,children:a})}),e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 top-1/2 h-px w-full bg-border"}),e.jsx("span",{className:"relative bg-card px-2 py-1",children:"or, enter the code manually"})]}),e.jsx("div",{className:"flex w-full space-x-2",children:e.jsx("div",{className:"flex w-full items-stretch overflow-hidden rounded-xl border border-border",children:t?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",readOnly:!0,value:t,className:"h-full w-full bg-background p-3 text-foreground outline-none"}),e.jsx("button",{onClick:()=>p(t),className:"border-l border-border px-3 hover:bg-muted",children:e.jsx(d,{className:"w-4"})})]}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted p-3",children:e.jsx(ye,{className:"size-4 animate-spin"})})})})]})})}function Yt({onClose:n,onBack:t}){const[a,s]=r.useState(""),c=r.useRef(null);return r.useEffect(()=>{setTimeout(()=>{c.current?.querySelector("input")?.focus()},0)},[]),e.jsx(U,{...qe.form(),onSuccess:()=>n(),resetOnError:!0,resetOnSuccess:!0,children:({processing:i,errors:p})=>e.jsx(e.Fragment,{children:e.jsxs("div",{ref:c,className:"relative w-full space-y-3",children:[e.jsxs("div",{className:"flex w-full flex-col items-center space-y-3 py-2",children:[e.jsx(Me,{id:"otp",name:"code",maxLength:se,onChange:s,disabled:i,pattern:Kt,children:e.jsx(Pe,{children:Array.from({length:se},(d,j)=>e.jsx(Ae,{index:j},j))})}),e.jsx(ot,{message:p?.confirmTwoFactorAuthentication?.code})]}),e.jsxs("div",{className:"flex w-full space-x-5",children:[e.jsx(_,{type:"button",variant:"outline",className:"flex-1",onClick:t,disabled:i,children:"Back"}),e.jsx(_,{type:"submit",className:"flex-1",disabled:i||a.length<se,children:"Confirm"})]})]})})})}function en({isOpen:n,onClose:t,requiresConfirmation:a,twoFactorEnabled:s,qrCodeSvg:c,manualSetupKey:i,clearSetupData:p,fetchSetupData:d,errors:j}){const[m,g]=r.useState(!1),h=r.useMemo(()=>s?{title:"Two-Factor Authentication Enabled",description:"Two-factor authentication is now enabled. Scan the QR code or enter the setup key in your authenticator app.",buttonText:"Close"}:m?{title:"Verify Authentication Code",description:"Enter the 6-digit code from your authenticator app",buttonText:"Continue"}:{title:"Enable Two-Factor Authentication",description:"To finish enabling two-factor authentication, scan the QR code or enter the setup key in your authenticator app",buttonText:"Continue"},[s,m]),v=r.useCallback(()=>{if(a){g(!0);return}p(),t()},[a,p,t]),S=r.useCallback(()=>{g(!1),s&&p()},[s,p]);return r.useEffect(()=>{if(!n){S();return}c||d()},[n,c,d,S]),e.jsx(lt,{open:n,onOpenChange:w=>!w&&t(),children:e.jsxs(it,{className:"sm:max-w-md",children:[e.jsxs(ct,{className:"flex items-center justify-center",children:[e.jsx(Zt,{}),e.jsx(dt,{children:h.title}),e.jsx(ut,{className:"text-center",children:h.description})]}),e.jsx("div",{className:"flex flex-col items-center space-y-5",children:m?e.jsx(Yt,{onClose:t,onBack:()=>g(!1)}):e.jsx(Ut,{qrCodeSvg:c,manualSetupKey:i,buttonText:h.buttonText,onNextStep:v,errors:j})})]})})}const tn=[{title:"Two-Factor Authentication",href:Ke.url()}];function gn({requiresConfirmation:n=!1,twoFactorEnabled:t=!1}){const{qrCodeSvg:a,hasSetupData:s,manualSetupKey:c,clearSetupData:i,fetchSetupData:p,recoveryCodesList:d,fetchRecoveryCodes:j,errors:m}=Xt(),[g,h]=r.useState(!1);return e.jsxs(mt,{breadcrumbs:tn,children:[e.jsx(We,{title:"Two-Factor Authentication"}),e.jsx(Qe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Je,{title:"Two-Factor Authentication",description:"Manage your two-factor authentication settings"}),t?e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(be,{variant:"default",children:"Enabled"}),e.jsx("p",{className:"text-muted-foreground",children:"With two-factor authentication enabled, you will be prompted for a secure, random pin during login, which you can retrieve from the TOTP-supported application on your phone."}),e.jsx(_t,{recoveryCodesList:d,fetchRecoveryCodes:j,errors:m}),e.jsx("div",{className:"relative inline",children:e.jsx(U,{...Xe.form(),children:({processing:v})=>e.jsxs(_,{variant:"destructive",type:"submit",disabled:v,children:[e.jsx(Tt,{})," Disable 2FA"]})})})]}):e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(be,{variant:"destructive",children:"Disabled"}),e.jsx("p",{className:"text-muted-foreground",children:"When you enable two-factor authentication, you will be prompted for a secure pin during login. This pin can be retrieved from a TOTP-supported application on your phone."}),e.jsx("div",{children:s?e.jsxs(_,{onClick:()=>h(!0),children:[e.jsx(je,{}),"Continue Setup"]}):e.jsx(U,{...Ze.form(),onSuccess:()=>h(!0),children:({processing:v})=>e.jsxs(_,{type:"submit",disabled:v,children:[e.jsx(je,{}),"Enable 2FA"]})})})]}),e.jsx(en,{isOpen:g,onClose:()=>h(!1),requiresConfirmation:n,twoFactorEnabled:t,qrCodeSvg:a,manualSetupKey:c,clearSetupData:i,fetchSetupData:p,errors:m})]})})]})}export{gn as default};
